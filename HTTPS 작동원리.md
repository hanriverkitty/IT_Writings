# HTTPS 작동원리

웹에서 정보를 보호하기 위한 가장 기본적인 기술이 HTTPS 이다

정보를 암호화하여 보내고, 상대방은 복호화하여 원래의 정보를 볼 수 있다

- SSL (Secure Socket Layer) 과 TLS (Transport Layer Security) 전송 기술이있다
- 웹 서버에 SSL/TLS 인증서를 설치한다
- 요즘은 대부분 TLS를 쓰지만, SSL 이라 잘못 부르고 있다

---

<br/>

> **SSL**

- 핸드셰이크 단계까지는 공개키 방식, 그 이후 HTTPS 통신은 대칭키 방식
- 대칭키 와 비대칭키 암호화 방식이 있다
  - 대칭키 : 암호화와 복호화를 동일한 키를 통해 한다
    - 키를 분실하거나 도난 당하며, 암호문을 다른 누군가가 볼 수 있다
  - 비대칭키 (공개키) : 수신자의 공개키로 암호화, 수신자의 개인키로 복호화
    - 개인키를 먼저 만들고, 공개키를 파생하여 한 쌍의 키를 만든다 (키페어)
    - 쌍이 아니라면 암호화/복호화가 불가능하다
    - 대칭키에 비해 안전하지만, 계산과정이 복잡하고 컴퓨터의 자원을 많이 사용한다

---

<br/>
<aside>
💡 핸드세이크 과정

</aside>

1. 클라이언트에 해당하는 브라우저가 웹서버에 접속한다
   - 브라우저가 사용하는 SSL, TLS 버전 정보
   - 브라우저가 지원하는 암호화 방식 모음
   - 브라우저가 순간적으로 생성한 임의의 난수
   - 이전에 핸드 셰이크가 완료된 상태라면, 그때 생성된 세션 아이디

<br/>

2. 웹서버는 1번에 응답하며 클라이언트에 정보를 제공한다

   - 브라우저가 전달한 암호화 방식들 중 서버가 지원하고 선택한 암호화 방식
   - 서버의 공개키가 담긴 SSL 인증서, 인증서는 CA의 비밀키로 암호화되어 발급된 상태
   - 서버가 순간적으로 생성한 임의의 난수

     ※ CA : SSL 보안 인증서를 발급하는 기관

<br/>

3. 브라우저는 서버의 SSL 인증서가 올바른지 확인한다
   - 대부분 브라우저에는 CA들의 정보와 공개키가 이미 설치되어있다
   - 서버가 보낸 인증서를 확인하기 위해 CA 공개키로 복호화한다

<br/>

4. 브라우저는 자신이 생성한 난수와 서버의 난수를 사용해 premaster secret을 만든다
   - 웹 서버 인증서에 딸려 온 웹 사이트의 공개키로 암호화하여 서버로 전송

<br/>

5. 서버는 사이트의 비밀키로, 브라우저가 보낸 premaster secret 값을 복호화한다
   - 복호화한 값을 master secret 값으로 저장한다
   - master secret 값을 사용하여 브라우저와 만들어진 연결에 고유한 값을 부여하기 위한 세션키를 생성한다
   - 세션키는 대칭키 암호화에 사용할 키이다

<br/>

6. SSL 핸드셰이크를 종료하고 HTTPS 통신을 시작
   - 웹상에서 데이터를 세션키를 사용해 암호화/복호화 한다
   - HTTPS 통신이 완료되는 시점에 공유된 세션키를 폐기한다
   - 세션이 유지되고 있다면 브라우저는 세션 ID만 서버에게 알려주면 된다

<br/>

출처 : https://yozm.wishket.com/magazine/detail/1852/
